<div class="container mx-auto px-4 py-8">
  <!-- Loading State -->
  @if (loading()) {
    <div class="flex justify-center items-center min-h-screen">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
    </div>
  }

  <!-- Error State -->
  @else if (error()) {
    <div class="max-w-2xl mx-auto">
      <div class="error-box">
        <p>{{ error() | transloco }}</p>
        <button (click)="loadProfile()" class="mt-2 text-sm underline">
          {{ 'common.retry' | transloco }}
        </button>
      </div>
    </div>
  }

  <!-- Profile Content -->
  @else if (statistics()) {
    <div class="max-w-6xl mx-auto">
      <!-- Header -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold mb-2">{{ 'profile.title' | transloco }}</h1>
        <p class="text-neutral-600">{{ statistics()?.username }}</p>
      </div>

      <!-- Statistics Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <!-- Games Played -->
        <div class="stats-card">
          <div class="stats-label">{{ 'profile.stats.gamesPlayed' | transloco }}</div>
          <div class="stats-value text-primary">{{ statistics()?.gamesPlayed || 0 }}</div>
        </div>

        <!-- Win Rate -->
        <div class="stats-card">
          <div class="stats-label">{{ 'profile.stats.winRate' | transloco }}</div>
          <div class="stats-value" [ngClass]="getWinRateColor(statistics()?.winRate || 0)">
            {{ (statistics()?.winRate || 0).toFixed(1) }}%
          </div>
        </div>

        <!-- Best Score -->
        <div class="stats-card">
          <div class="stats-label">{{ 'profile.stats.bestScore' | transloco }}</div>
          <div class="stats-value text-success">{{ statistics()?.bestScore || 0 }}</div>
        </div>

        <!-- Average Score -->
        <div class="stats-card">
          <div class="stats-label">{{ 'profile.stats.averageScore' | transloco }}</div>
          <div class="stats-value text-info">{{ (statistics()?.averageScore || 0).toFixed(1) }}</div>
        </div>
      </div>

      <!-- Detailed Stats -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Win/Loss Stats -->
        <div class="stats-card">
          <h2 class="text-xl font-bold mb-4">{{ 'profile.sections.winLoss' | transloco }}</h2>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-neutral-600">{{ 'profile.stats.gamesWon' | transloco }}</span>
              <span class="font-semibold text-success">{{ statistics()?.gamesWon || 0 }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-neutral-600">{{ 'profile.stats.gamesLost' | transloco }}</span>
              <span class="font-semibold text-danger">{{ statistics()?.gamesLost || 0 }}</span>
            </div>
            <div class="border-t pt-3 flex justify-between">
              <span class="text-neutral-600">{{ 'profile.stats.totalPoints' | transloco }}</span>
              <span class="font-semibold">{{ statistics()?.totalPoints || 0 }}</span>
            </div>
          </div>
        </div>

        <!-- Objectives & Effects -->
        <div class="stats-card">
          <h2 class="text-xl font-bold mb-4">{{ 'profile.sections.objectives' | transloco }}</h2>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-neutral-600">{{ 'profile.stats.objectivesCompleted' | transloco }}</span>
              <span class="font-semibold">{{ statistics()?.objectivesCompleted || 0 }} / {{ statistics()?.objectivesTotal || 0 }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-neutral-600">{{ 'profile.stats.effectsActivated' | transloco }}</span>
              <span class="font-semibold text-primary">{{ statistics()?.effectsActivated || 0 }}</span>
            </div>
            <div class="border-t pt-3 flex justify-between">
              <span class="text-neutral-600">{{ 'profile.stats.tricksWon' | transloco }}</span>
              <span class="font-semibold">{{ statistics()?.tricksWonTotal || 0 }} ({{ (statistics()?.tricksWonAverage || 0).toFixed(1) }} {{ 'profile.stats.perGame' | transloco }})</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Game History -->
      <div class="stats-card mb-8">
        <h2 class="text-xl font-bold mb-4">{{ 'profile.sections.history' | transloco }}</h2>
        @if (gameHistory().length > 0) {
          <div class="overflow-x-auto">
            <table class="min-w-full">
              <thead class="bg-neutral-50">
                <tr>
                  <th class="table-header">{{ 'profile.history.date' | transloco }}</th>
                  <th class="table-header">{{ 'profile.history.result' | transloco }}</th>
                  <th class="table-header">{{ 'profile.history.score' | transloco }}</th>
                  <th class="table-header">{{ 'profile.history.players' | transloco }}</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-neutral-200">
                @for (game of gameHistory(); track game.gameId) {
                  <tr>
                    <td class="table-cell">{{ formatDate(game.playedAt) }}</td>
                    <td class="table-cell">
                      <span [ngClass]="game.won ? 'text-success font-semibold' : 'text-danger'">
                        {{ (game.won ? 'profile.history.victory' : 'profile.history.defeat') | transloco }}
                      </span>
                    </td>
                    <td class="table-cell font-semibold">{{ game.score }}</td>
                    <td class="table-cell">{{ game.playerCount }}</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <p class="text-secondary-muted text-center py-4">{{ 'profile.history.empty' | transloco }}</p>
        }
      </div>

      <!-- Actions -->
      <div class="flex justify-end gap-4">
        <button
          (click)="resetStatistics()"
          class="danger-btn"
          [attr.aria-label]="'profile.actions.reset' | transloco"
        >
          {{ 'profile.actions.reset' | transloco }}
        </button>
      </div>
    </div>
  }
</div>
