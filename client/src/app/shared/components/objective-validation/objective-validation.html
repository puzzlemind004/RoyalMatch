<!-- Objective Validation Component -->
<div class="mx-auto max-w-6xl p-4">
  <!-- Header -->
  <div class="mb-6 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 p-6 text-white shadow-lg">
    <h2 class="mb-2 text-2xl font-bold sm:text-3xl">
      {{ 'objectives.validation.title' | transloco }}
    </h2>
    <p class="text-sm opacity-90 sm:text-base">
      {{ 'objectives.validation.drawnObjectives' | transloco }}
    </p>
    <p class="mt-1 text-lg font-semibold">
      {{ 'objectives.validation.objectivesCount' | transloco: { count: objectives().length } }}
    </p>
  </div>

  <!-- Circular Timer -->
  <div class="mb-6 rounded-lg border-2 border-gray-300 bg-white p-6 text-center shadow-md">
    <app-circular-timer
      [remainingTime]="remainingTime()"
      [totalTime]="TIMER_TOTAL_DURATION"
      [size]="160"
    />
    @if (remainingTime() <= 10 && !isValidated()) {
      <p class="mt-4 text-sm font-semibold text-red-600 animate-pulse">
        {{ 'objectives.validation.autoValidation' | transloco: { time: remainingTime() } }}
      </p>
    }
  </div>

  <!-- Error Message -->
  @if (error()) {
    <div class="mb-6 rounded-lg border-2 border-red-500 bg-red-50 p-4 text-red-700">
      <p class="font-semibold">{{ error() | transloco }}</p>
    </div>
  }

  <!-- Validated Success Message -->
  @if (isValidated()) {
    <div class="mb-6 rounded-lg border-2 border-green-500 bg-green-50 p-4 text-green-700">
      <p class="text-lg font-bold">{{ 'objectives.validation.validated' | transloco }}</p>
    </div>
  }

  <!-- Objectives Grid -->
  <div class="mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
    @for (objective of objectives(); track objective.id) {
      <app-objective-card
        [objective]="objective"
        [canReject]="canReject()"
        [isRejected]="isObjectiveRejected(objective.id)"
        [showActions]="!isValidated()"
        (reject)="rejectObjective($event)"
      />
    }
  </div>

  <!-- Summary Bar -->
  <div class="mb-6 rounded-lg border-2 border-blue-300 bg-blue-50 p-4">
    <div class="flex flex-col items-center justify-between gap-4 sm:flex-row">
      <div>
        <p class="text-sm text-gray-600">
          {{ 'objectives.validation.totalPoints' | transloco: { points: totalPoints() } }}
        </p>
        @if (rejectedCount() > 0) {
          <p class="mt-1 text-sm text-red-600">
            {{
              'objectives.validation.rejectLimit'
                | transloco: { max: MAX_REJECTS - rejectedCount() }
            }}
          </p>
        }
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  @if (!isValidated()) {
    <div class="flex flex-col gap-4 sm:flex-row">
      <!-- Redraw Button -->
      <button
        type="button"
        class="flex-1 rounded-lg border-2 border-orange-500 bg-white px-6 py-3 text-lg font-semibold text-orange-600 transition-all hover:bg-orange-50 disabled:cursor-not-allowed disabled:opacity-50"
        [disabled]="!canRedraw() || loading()"
        (click)="redrawObjectives()"
      >
        @if (hasRedrawn()) {
          {{ 'objectives.validation.redrawUsed' | transloco }}
        } @else {
          {{ 'objectives.validation.redrawButton' | transloco }}
        }
      </button>

      <!-- Validate Button -->
      <button
        type="button"
        class="flex-1 rounded-lg bg-gradient-to-r from-green-500 to-blue-600 px-6 py-3 text-lg font-bold text-white shadow-lg transition-all hover:from-green-600 hover:to-blue-700 disabled:cursor-not-allowed disabled:opacity-50"
        [disabled]="!canValidate() || loading()"
        (click)="validateObjectives()"
      >
        @if (loading()) {
          {{ 'common.loading' | transloco }}
        } @else {
          {{ 'objectives.validation.validateButton' | transloco }}
        }
      </button>
    </div>
  }
</div>
